<html>
    <body style="margin-left: 50px;margin-top:20px">
        <h1>signup page</h1>
            <table id="form">
                <tr>
                    <td><label >Email</label></td>
                    <td><input id="email" type="mail"></td>
                </tr>
                <tr>
                    <td><label>user name: </label></td>
                    <td><input id="name" name="username"></td>
                </tr>
                <tr>
                    <td><label>password :</label></td>
                    <td><input id="password" name="password"></td>
                </tr>
                <tr>
                    <td><label>confirm  password :</label></td>
                    <td><input name="password"></td>
                </tr>
                <tr>
                    <td><button onclick="fun()" >submit</button></td>
                    <td><a href="index.html">login</a></td>
                </tr>
            
            </table>
            <div id='otp' hidden>
                <h3>OTP </h3>
                <p>Enter your otp </p>
                <p>we sent a otp to <strong id="gmail-otp"></strong></p>
                <input type="number" id="input-otp" name="otp">
                <button onclick="checkotp()" >submit</button>
            </div>
            
            
            <script>
                var data={}
                function fun(){
                    var myHeaders = new Headers();
                    myHeaders.append("Content-Type", "application/json");
    
                    var raw = JSON.stringify({
                        "email":document.getElementById("email").value,
                    "name": document.getElementById("name").value,
                    "password": document.getElementById("password").value,
                    });
                    var requestOptions = {
                    method: 'POST',
                    mode:'cors',
                    headers: myHeaders,
                    body: raw,
                    redirect: 'follow'
                    };
                    console.log(raw)
                    fetch("https://chat-clone1.herokuapp.com/signup", requestOptions)
                    .then(response => response.text())
                    .then(result => {
                        console.log(result)
                        if(result=="otp success"){
                            document.getElementById("gmail-otp").innerHTML=document.getElementById("email").value
                            document.getElementById("form").style.display ='none'
                            document.getElementById("otp").style.display="block"
                            
                        }else{
                            alert("user already exist")
                        }
                    })
                    .catch(error => console.log('error', error));
    }


                function checkotp(){
                    var myHeaders = new Headers();
                    myHeaders.append("Content-Type", "application/json");
    
                    var raw = JSON.stringify({
                    "email":document.getElementById("email").value,
                    "name": document.getElementById("name").value,
                    "password": document.getElementById("password").value,
                    "otp":document.getElementById("input-otp").value
                    });
    
                    var requestOptions = {
                    method: 'POST',
                    mode:'cors',
                    headers: myHeaders,
                    body: raw,
                    redirect: 'follow'
                    };
                    console.log(raw)
                    fetch("https://chat-clone1.herokuapp.com/checkotp", requestOptions)
                    .then(response => response.text())
                    .then(result => {
                        console.log(result)
                        if(result=="success"){
                            alert("successful signup")
                            window.location.href = "index.html";
                        }
                        
                    })
                    .catch(error => console.log('error', error));
                }
            </script>
            

            
            
            
            
            
        </form>
    </body>
</html>
